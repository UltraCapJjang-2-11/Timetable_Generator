{% load static %}
{% load dictionary_extras %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Mypage</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="{% static 'home/css/base_style.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'home/css/mypage_style.css' %}">
  <style>
    .sub-table { margin-top: 10px; font-size: 0.9rem; }
    .sub-table th, .sub-table td { padding: 4px; text-align: center; }
    
    /* From Uiverse.io by elijahgummer */ 
    .upload-button {
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: linear-gradient(45deg, #ffc75d, #ffc708);
      box-shadow: 0 0 24px #ffb20861;
      border: 2px solid #ffe825;
      border-radius: 100px;
      transition: background-color 0.3s ease, box-shadow 0.3s ease,
        text-shadow 0.3s ease;
      padding: 10px 20px;
      color: #09090b;
      font-weight: bold;
      text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
      position: relative;
    }

    .upload-button:hover {
      background-color: #ffc75d !important;
      box-shadow: 0 0 34px #ffb20861 !important;
      text-shadow: 0 0 4px #ffe825;
      border-color: #ffe825 !important;
    }

    .upload-icon {
      margin-right: 5px;
      filter: drop-shadow(2px 2px 5px rgba(0, 0, 0, 0.3));
    }

    #graduation_pdf {
      display: none;
    }

    .upload-section {
      position: relative;
      margin-bottom: 20px;
    }

    .upload-button-container {
      position: absolute;
      top: -60px;
      right: 0;
      z-index: 10;
      white-space: nowrap;
    }
    
    .upload-button-container .text-muted {
      font-size: 0.9rem;
      max-width: 200px;
      line-height: 1.3;
    }
  </style>
</head>
<body>

<!-- ✅ header -->
<header>
  <nav class="navigation">
      <a href="{% url 'dashboard' %}" class="logo"><img src="https://github.com/KSM017/ImageSource/blob/main/002.png?raw=true" alt="로고"></a>
      <div class="nav-links">
          <a href="{% url 'dashboard' %}">Home<span></span></a>
          <a href="{% url 'manage' %}">Manage<span></span></a>
          <a href="{% url 'mypage' %}">MyPage<span></span></a>
          <a href="{% url 'timetable' %}">TimeTable<span></span></a>
          <a href="{% url 'logout' %}">Logout<span></span></a>
      </div>
  </nav>
</header> 
<!-- ✅ end header -->

<div class="container" style="margin-top: 70px;">

  <!-- 사용자 정보 -->
  <div class="row mb-4 upload-section">
    <div class="col-md-6">
      <div class="card notification-card">
        <div class="tools">
          <div class="circle">
            <span class="red box"></span>
          </div>
          <div class="circle">
            <span class="yellow box"></span>
          </div>
          <div class="circle">
            <span class="green box"></span>
          </div>
        </div>
        <div class="card-header">개인 정보</div>
        <div class="card-body">
          <p><strong>학번:</strong> {{ user_student_id }}</p>
          <p><strong>이름:</strong> {{ user_name }}</p>
          <p><strong>전공:</strong> {{ user_major }}</p>
          <p><strong>학년:</strong> {{ user_year }}</p>

        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card notification-card">
        <div class="tools">
          <div class="circle">
            <span class="red box"></span>
          </div>
          <div class="circle">
            <span class="yellow box"></span>
          </div>
          <div class="circle">
            <span class="green box"></span>
          </div>
        </div>
        <div class="card-header">알림</div>
        <div class="card-body">
          {% if alerts %}
            {% for msg in alerts %}
              <p>• {{ msg }}</p>
            {% endfor %}
          {% else %}
            <p>알림이 없습니다.</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>



  <!-- 이수 과목 및 졸업 요건 섹션 -->
  <div class="row mb-4">
    <div class="col-md-12">
      <h4>이수 과목 현황</h4>
      <div class="row">
        <div class="col-md-4">
          <div class="card">
            <div class="p-3">
              <div class="summary-box mb-3">
                <h6 class="text-muted">전체 요약</h6>
                <p class="mb-1"><strong>총 이수 학점:</strong> <span id="mypage-total-credits">0</span></p>
                <p class="mb-0"><strong>전체 평점 평균:</strong> <span id="mypage-total-gpa">0.00</span></p>
              </div>
              <h6 class="text-muted">학기 목록</h6>
              <ul id="mypage-semester-list" class="list-group" style="max-height: 250px; overflow-y: auto;"></ul>
            </div>
          </div>
        </div>
        <div class="col-md-8">
          <div class="card">
            <div class="p-3">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="summary-box">
                  <h5 id="mypage-semester-title">학기를 선택하세요</h5>
                  <p class="mb-0 text-muted">이수 학점: <span id="mypage-semester-credits">0</span> | 평점 평균: <span id="mypage-semester-gpa">0.00</span></p>
                </div>
              </div>
              <div id="mypage-course-list" style="max-height: 300px; overflow-y: auto;"></div>
            </div>
          </div>
        </div>
      </div>

      <h4 class="mt-4">졸업 요건 이수 현황</h4>
      <div class="row">
        <div class="col-md-6">
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>구분</th>
                <th>이수 학점</th>
                <th>졸업 기준</th>
                <th>미이수</th>
                <th>충족</th>
              </tr>
            </thead>
            <tbody id="requirements-table-body">
              <!-- JS로 동적 렌더링 -->
            </tbody>
          </table>
        </div>
        <div class="col-md-6">
          <div class="row g-3">
            <div class="col-12">
              <div class="chart-container">
                <canvas id="semesterGpaChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Chart.js (mypage.js에서 사용) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- 데이터 바인딩 -->
<script id="course-history-data" type="application/json">{{ course_history_json|safe }}</script>
<script id="requirements-tree-data" type="application/json">{{ requirements_tree_json|safe }}</script>
<!-- 별도 JS 파일 (mypage.js) -->
<script src="{% static 'home/js/mypage.js' %}"></script>

</body>
</html>