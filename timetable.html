<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ì‹œê°„í‘œ ìƒì„±</title>

    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'home/css/base_style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'home/css/timetable_style.css' %}">

    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© CSS ì¶”ê°€ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- (ì¶”ê°€) ì§„í–‰ ìƒí™© ì˜¤ë²„ë ˆì´ ìŠ¤íƒ€ì¼ -->
    <style>
      #progress-overlay {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0,0,0,0.5);
          z-index: 10000;
      }
      #progress-message {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: white;
          padding: 20px;
          border-radius: 10px;
          text-align: center;
      }
      #progress-bar {
          width: 300px;
          height: 20px;
          background: #ddd;
          border-radius: 10px;
          overflow: hidden;
          margin-top: 10px;
      }
      #progress-fill {
          width: 0%;
          height: 100%;
          background: #4caf50;
      }
    </style>
    
</head>
<body>
    <!-- header -->
    <header>
        <nav class="navigation">
            <a href="{% url 'dashboard' %}" class="logo">
                <img src="https://github.com/KSM017/ImageSource/blob/main/002.png?raw=true" alt="ë¡œê³ ">
            </a>
            <div class="nav-links">
                <a href="{% url 'dashboard' %}">Home<span></span></a>
                <a href="{% url 'manage' %}">Manage<span></span></a>
                <a href="{% url 'mypage' %}">MyPage<span></span></a>
                <a href="{% url 'timetable' %}">TimeTable<span></span></a>
                <a href="#">Logout<span></span></a>
            </div>
        </nav>
    </header> 
    <!-- ì»¨í…Œì´ë„ˆ -->
    <div class="container-fluid">
        <!-- ì™¼ìª½ íŒ¨ë„: ê°•ì˜ ê²€ìƒ‰/í•„í„° ë° ê°•ì˜ ëª©ë¡ -->
        <div class="left-panel">
            <div class="course-search-container">
                <input type="text" id="course-search" placeholder="ê°•ì˜ ê²€ìƒ‰..." class="course-search">
                <div class="filter-buttons">
                    <button class="filter-btn active" data-type="all">ì „ì²´</button>
                    <button class="filter-btn" data-type="major_required">ì „ê³µí•„ìˆ˜</button>
                    <button class="filter-btn" data-type="major_elective">ì „ê³µì„ íƒ</button>
                    <button class="filter-btn" data-type="general_elective">êµì–‘ì„ íƒ</button>
                    <button class="filter-btn" data-type="free_elective">ì¼ë°˜ì„ íƒ</button>
                    <button class="filter-btn" data-type="teaching_required">êµì§í•„ìˆ˜</button>
                </div>
            </div>
            <!-- ê°•ì˜ ë¦¬ìŠ¤íŠ¸ -->
            <div class="course-list-container">
                <!-- ì „ê³µ í•„ìˆ˜ -->
                <div class="course-category" id="major-required">
                    {% for course in major_required %}
                        <div class="course-item" data-type="major_required" data-course-id="{{ course.course_id }}">
                            <div class="course-name">{{ course.course_name }}</div>
                            <div class="course-info">
                                <span class="instructor">{{ course.instructor }}</span>
                                <span class="credit">{{ course.credit }}í•™ì </span>
                                <span class="year">{{ course.year }}</span>
                                <span class="section">{{ course.section }}</span>
                            </div>
                            <div class="course-meta">
                                {% with schedules=course.courseschedule_set.all %}
                                    {% if schedules %}
                                        <span class="course-schedule">
                                            ({% for s in schedules %}{{ s.day }} / {{ s.times }}{% if not forloop.last %}; {% endif %}{% endfor %})
                                        </span>
                                    {% else %}
                                        <span class="course-schedule">(ìŠ¤ì¼€ì¤„ ì •ë³´ ì—†ìŒ)</span>
                                    {% endif %}
                                {% endwith %}
                            </div>
                            <!-- ëª¨ë“  ìŠ¤ì¼€ì¤„ ì •ë³´ë¥¼ ìˆ¨ê¹€ divì— ì €ì¥ (í˜•ì‹: "ê³¼ëª©ëª… ì¥ì†Œ") -->
                            <div class="course-schedules" style="display: none;">
                                {% for s in course.courseschedule_set.all %}
                                    {% if forloop.first %}
                                        {{ s.day }}:{{ s.times }}@{{ s.location }}
                                    {% else %}
                                        ;{{ s.day }}:{{ s.times }}@{{ s.location }}
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <button class="add-course-btn">ì¶”ê°€</button>
                        </div>
                    {% empty %}
                        <p class="no-courses">ì „ê³µ í•„ìˆ˜ ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    {% endfor %}
                </div>
                <!-- ì „ê³µ ì„ íƒ -->
                <div class="course-category" id="major-elective">
                    {% for course in major_elective %}
                        <div class="course-item" data-type="major_elective" data-course-id="{{ course.course_id }}">
                            <div class="course-name">{{ course.course_name }}</div>
                            <div class="course-info">
                                <span class="instructor">{{ course.instructor }}</span>
                                <span class="credit">{{ course.credit }}í•™ì </span>
                                <span class="year">{{ course.year }}</span>
                                <span class="section">{{ course.section }}</span>
                            </div>
                            <div class="course-meta">
                                {% with schedules=course.courseschedule_set.all %}
                                    {% if schedules %}
                                        <span class="course-schedule">
                                            ({% for s in schedules %}{{ s.day }} / {{ s.times }}{% if not forloop.last %}; {% endif %}{% endfor %})
                                        </span>
                                    {% else %}
                                        <span class="course-schedule">(ìŠ¤ì¼€ì¤„ ì •ë³´ ì—†ìŒ)</span>
                                    {% endif %}
                                {% endwith %}
                            </div>
                            <div class="course-schedules" style="display: none;">
                                {% for s in course.courseschedule_set.all %}
                                    {% if forloop.first %}
                                        {{ s.day }}:{{ s.times }}
                                    {% else %}
                                        ;{{ s.day }}:{{ s.times }}
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <button class="add-course-btn">ì¶”ê°€</button>
                        </div>
                    {% empty %}
                        <p class="no-courses">ì „ê³µ ì„ íƒ ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    {% endfor %}
                </div>
                <!-- êµì–‘ ì„ íƒ -->
                <div class="course-category" id="general-elective">
                    {% for course in general_elective %}
                        <div class="course-item" data-type="general_elective" data-course-id="{{ course.course_id }}">
                            <div class="course-name">{{ course.course_name }}</div>
                            <div class="course-info">
                                <span class="instructor">{{ course.instructor }}</span>
                                <span class="credit">{{ course.credit }}í•™ì </span>
                                <span class="year">{{ course.year }}</span>
                                <span class="section">{{ course.section }}</span>
                            </div>
                            <div class="course-meta">
                                {% with schedules=course.courseschedule_set.all %}
                                    {% if schedules %}
                                        <span class="course-schedule">
                                            ({% for s in schedules %}{{ s.day }} / {{ s.times }}{% if not forloop.last %}; {% endif %}{% endfor %})
                                        </span>
                                    {% else %}
                                        <span class="course-schedule">(ìŠ¤ì¼€ì¤„ ì •ë³´ ì—†ìŒ)</span>
                                    {% endif %}
                                {% endwith %}
                            </div>
                            <div class="course-schedules" style="display: none;">
                                {% for s in course.courseschedule_set.all %}
                                    {% if forloop.first %}
                                        {{ s.day }}:{{ s.times }}
                                    {% else %}
                                        ;{{ s.day }}:{{ s.times }}
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <button class="add-course-btn">ì¶”ê°€</button>
                        </div>
                    {% empty %}
                        <p class="no-courses">êµì–‘ ì„ íƒ ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    {% endfor %}
                </div>
                <!-- ì¼ë°˜ ì„ íƒ -->
                <div class="course-category" id="free-elective">
                    {% for course in free_elective %}
                        <div class="course-item" data-type="free_elective" data-course-id="{{ course.course_id }}">
                            <div class="course-name">{{ course.course_name }}</div>
                            <div class="course-info">
                                <span class="instructor">{{ course.instructor }}</span>
                                <span class="credit">{{ course.credit }}í•™ì </span>
                                <span class="year">{{ course.year }}</span>
                                <span class="section">{{ course.section }}</span>
                            </div>
                            <div class="course-meta">
                                {% with schedules=course.courseschedule_set.all %}
                                    {% if schedules %}
                                        <span class="course-schedule">
                                            ({% for s in schedules %}{{ s.day }} / {{ s.times }}{% if not forloop.last %}; {% endif %}{% endfor %})
                                        </span>
                                    {% else %}
                                        <span class="course-schedule">(ìŠ¤ì¼€ì¤„ ì •ë³´ ì—†ìŒ)</span>
                                    {% endif %}
                                {% endwith %}
                            </div>
                            <div class="course-schedules" style="display: none;">
                                {% for s in course.courseschedule_set.all %}
                                    {% if forloop.first %}
                                        {{ s.day }}:{{ s.times }}
                                    {% else %}
                                        ;{{ s.day }}:{{ s.times }}
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <button class="add-course-btn">ì¶”ê°€</button>
                        </div>
                    {% empty %}
                        <p class="no-courses">ì¼ë°˜ ì„ íƒ ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    {% endfor %}
                </div>
                <!-- êµì§ í•„ìˆ˜ -->
                <div class="course-category" id="teaching-required">
                    {% for course in teaching_required %}
                        <div class="course-item" data-type="teaching_required" data-course-id="{{ course.course_id }}">
                            <div class="course-name">{{ course.course_name }}</div>
                            <div class="course-info">
                                <span class="instructor">{{ course.instructor }}</span>
                                <span class="credit">{{ course.credit }}í•™ì </span>
                                <span class="year">{{ course.year }}</span>
                                <span class="section">{{ course.section }}</span>
                            </div>
                            <div class="course-meta">
                                {% with schedules=course.courseschedule_set.all %}
                                    {% if schedules %}
                                        <span class="course-schedule">
                                            ({% for s in schedules %}{{ s.day }} / {{ s.times }}{% if not forloop.last %}; {% endif %}{% endfor %})
                                        </span>
                                    {% else %}
                                        <span class="course-schedule">(ìŠ¤ì¼€ì¤„ ì •ë³´ ì—†ìŒ)</span>
                                    {% endif %}
                                {% endwith %}
                            </div>
                            <div class="course-schedules" style="display: none;">
                                {% for s in course.courseschedule_set.all %}
                                    {% if forloop.first %}
                                        {{ s.day }}:{{ s.times }}
                                    {% else %}
                                        ;{{ s.day }}:{{ s.times }}
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <button class="add-course-btn">ì¶”ê°€</button>
                        </div>
                    {% empty %}
                        <p class="no-courses">êµì§ í•„ìˆ˜ ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
        <!-- ê°€ìš´ë° íŒ¨ë„: ì‹œê°„í‘œ í‘œì‹œ -->
        <div class="middle-panel">
            <table class="timetable">
                <thead>
                    <tr>
                        <th>ì‹œê°„</th>
                        <th>ì›”</th>
                        <th>í™”</th>
                        <th>ìˆ˜</th>
                        <th>ëª©</th>
                        <th>ê¸ˆ</th>
                    </tr>
                </thead>
                <tbody>
                    <script>
                        const timetableBody = document.querySelector(".timetable tbody");
                        for (let hour = 9; hour <= 18; hour++) {
                            const row = document.createElement("tr");
                            const timeCell = document.createElement("td");
                            timeCell.textContent = `${hour}:00`;
                            row.appendChild(timeCell);
                            for (let i = 0; i < 5; i++) {
                                const cell = document.createElement("td");
                                cell.classList.add("timetable-cell");
                                cell.setAttribute("data-hour", hour);
                                cell.setAttribute("data-day", i);
                                row.appendChild(cell);
                            }
                            timetableBody.appendChild(row);
                        }
                    </script>
                </tbody>
            </table>
        </div>
        <!-- ì˜¤ë¥¸ìª½ íŒ¨ë„: ì„¤ì • ë° íƒìƒ‰ -->
        <div class="right-panel">
            <div class="goal-settings">
                <h3>ëª©í‘œ í•™ì  ì„¤ì • ğŸ¯</h3>
                <div class="goal-inputs">
                    <label for="total-credits">ì´ ëª©í‘œ í•™ì  (ìµœëŒ€ 24):</label>
                    <input type="number" id="total-credits" min="1" max="24" value="18">
                    
                    <label for="major-credits">ì „ê³µ í•™ì :</label>
                    <input type="number" id="major-credits" min="0" max="24" value="9">
                    
                    <label for="elective-credits">êµì–‘ í•™ì :</label>
                    <input type="number" id="elective-credits" min="0" max="24" value="9">
                </div>
            </div>
            <div class="day-off-settings">
                <h3>í¬ë§ ê³µê°• ìš”ì¼ ğŸ“…</h3>
                <div class="day-options">
                    <label><input type="checkbox" value="ì›”"> ì›”</label>
                    <label><input type="checkbox" value="í™”"> í™”</label>
                    <label><input type="checkbox" value="ìˆ˜"> ìˆ˜</label>
                    <label><input type="checkbox" value="ëª©"> ëª©</label>
                    <label><input type="checkbox" value="ê¸ˆ"> ê¸ˆ</label>
                </div>
            </div>
            <button id="generate-btn">ğŸ“… ì‹œê°„í‘œ ìƒì„±</button>
            <div class="timetable-navigation">
                <button id="prev-timetable" class="nav-arrow">â—€</button>
                <span id="timetable-index">1 / 1</span>
                <button id="next-timetable" class="nav-arrow">â–¶</button>
            </div>
            <button id="save-timetable-btn">ğŸ’¾ í˜„ì¬ ì‹œê°„í‘œ ì €ì¥</button>

        </div>
    </div>
    
    <!-- ì§„í–‰ ìƒí™© ì˜¤ë²„ë ˆì´ (ì¶”ê°€ëœ ë¶€ë¶„) -->
    <div id="progress-overlay">
      <div id="progress-message">
        <p id="progress-text">ì‹œê°„í‘œ ìƒì„± ì¤‘...</p>
        <div id="progress-bar">
          <div id="progress-fill"></div>
        </div>
        <p id="progress-count"></p>
      </div>
    </div>


    <!-- AI ì±„íŒ…ì°½ -->
    <div id="ai-chat-toggle">ğŸ’¬</div>
    <div id="ai-chat-widget">
        <div class="ai-chat-header">
            <img src="https://github.com/KSM017/ImageSource/blob/main/002.png?raw=true" alt="AI" class="ai-avatar">
            <div class="ai-info">
                <strong>Suna</strong><br>
                <small>AI ë„ìš°ë¯¸</small>
            </div>
            <button id="ai-close-btn">Ã—</button>
        </div>
        <div class="ai-chat-body">
            <div class="chat-time" id="chat-time-initial"></div>
            <div class="chat-bubble bot">ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” Sunaì…ë‹ˆë‹¤.<br>ê¶ê¸ˆí•˜ì‹  ì ì„ ì•Œë ¤ì£¼ì‹œë©´ ë‹µë³€ë“œë¦´ê²Œìš”!</div>
        </div>
        <div class="ai-chat-input">
           <input type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
           <button>â¤</button>
        </div>
    </div>            

    
    <!-- AI ì±„íŒ…ì°½ ê¸°ëŠ¥ -->
    <script>
        const chatToggle = document.getElementById("ai-chat-toggle");
        const chatWidget = document.getElementById("ai-chat-widget");
        const closeBtn = document.getElementById("ai-close-btn");
        const input = document.querySelector(".ai-chat-input input");
        const sendBtn = document.querySelector(".ai-chat-input button");
        const chatBody = document.querySelector(".ai-chat-body");
      
        chatToggle.addEventListener("click", () => {
          chatWidget.style.display = "flex";
          chatToggle.style.display = "none";
        });
      
        closeBtn.addEventListener("click", () => {
          chatWidget.style.display = "none";
          chatToggle.style.display = "flex";
        });
      
        sendBtn.addEventListener("click", sendMessage);
        input.addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            sendMessage();
          }
        });
      
        function getCurrentTime() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const period = hours < 12 ? 'ì˜¤ì „' : 'ì˜¤í›„';
            const hour12 = hours % 12 === 0 ? 12 : hours % 12;
            return `ì˜¤ëŠ˜ ${period} ${hour12}:${minutes}`;
        }
          
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ì±„íŒ… ì‹œê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
        document.getElementById("chat-time-initial").textContent = getCurrentTime();

        function sendMessage() {
          const text = input.value.trim();
          if (!text) return;
      
          // ë§í’ì„  ìƒì„±
          const bubble = document.createElement("div");
          bubble.className = "chat-bubble user";
          bubble.textContent = text;
      
          chatBody.appendChild(bubble);
          input.value = "";
      
          // ìŠ¤í¬ë¡¤ ë§¨ ì•„ë˜ë¡œ
          chatBody.scrollTop = chatBody.scrollHeight;

          setTimeout(() => {
            addBotResponse(text); // ê·¸ëŒ€ë¡œ ì „ë‹¬
          }, 800);
        }

        function getBotReply(userText) {
            const lower = userText.toLowerCase();
          
            if (lower.includes("ì‹œê°„í‘œ")) {
              return "ì‹œê°„í‘œë¥¼ ë§Œë“¤ê³  ì‹¶ìœ¼ì‹œë©´ 'ì‹œê°„í‘œ ìƒì„±' ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!";
            } else if (lower.includes("ì¶”ì²œ") || lower.includes("ê³¼ëª©")) {
              return "ê´€ì‹¬ ë¶„ì•¼ë‚˜ ì›í•˜ëŠ” ê³µê°• ìš”ì¼ì´ ìˆë‹¤ë©´ ë§ì”€í•´ì£¼ì„¸ìš” :)";
            } else if (lower.includes("ì•ˆë…•") || lower.includes("hello")) {
              return "ì•ˆë…•í•˜ì„¸ìš”! Sunaì—ìš” :) ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?";
            } else {
              return "ì£„ì†¡í•´ìš”, ì•„ì§ ê·¸ê±´ ì˜ ëª¨ë¥´ê² ì–´ìš” \n'ì‹œê°„í‘œ', 'ì¶”ì²œ', 'ì•ˆë…•' ê°™ì€ í‚¤ì›Œë“œë¥¼ ì¨ë³´ì‹¤ë˜ìš”?";
            }

            // ì´ í•¨ìˆ˜ ë‚´ìš©ë§Œ GPT ì‘ë‹µìœ¼ë¡œ êµì²´í•˜ë©´ ë¨
        }

        function addBotResponse(userText) {
            const reply = getBotReply(userText); // ì—¬ê¸°ë§Œ ë‚˜ì¤‘ì— GPT ì‘ë‹µìœ¼ë¡œ êµì²´í•˜ë©´ ë¨
          
            const timeStamp = document.createElement("div");
            timeStamp.className = "chat-time";
            timeStamp.textContent = getCurrentTime();
            chatBody.appendChild(timeStamp);
          
            const botBubble = document.createElement("div");
            botBubble.className = "chat-bubble bot";
            botBubble.textContent = reply;
            chatBody.appendChild(botBubble);
          
            chatBody.scrollTop = chatBody.scrollHeight;
        }
          
    </script>
      



    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© JS ì¶”ê°€ -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- ì—…ë°ì´íŠ¸ëœ timetable_script.js íŒŒì¼ ì—°ê²° -->
    <script src="{% static 'home/js/timetable_script.js' %}"></script>
</body>
</html>
