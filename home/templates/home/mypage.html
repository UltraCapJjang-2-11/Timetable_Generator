{% load static %}
{% load dictionary_extras %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Mypage</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="{% static 'home/css/base_style.css' %}">
  <link rel="stylesheet" href="{% static 'home/css/mypage_style.css' %}">
</head>
<body>

<!-- ✅ Header -->
<header>
  <nav class="navigation">
      <a href="{% url 'dashboard' %}" class="logo"><img src="https://github.com/KSM017/ImageSource/blob/main/002.png?raw=true" alt="로고"></a>
      <div class="nav-links">
          <a href="{% url 'dashboard' %}">Home<span></span></a>
          <a href="{% url 'manage' %}">Manage<span></span></a>
          <a href="{% url 'mypage' %}">MyPage<span></span></a>
          <a href="{% url 'timetable' %}">TimeTable<span></span></a>
          <a href="{% url 'logout' %}">Logout<span></span></a>
      </div>
  </nav>
</header> 

<!-- ✅ 전체 레이아웃 -->
<div class="mypage-wrapper container">

  <!-- 🔹 왼쪽 패널 -->
  <div class="left-panel">
    <!-- 프로필 -->
    <div class="profile-section text-center">
      <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="프로필 이미지" class="profile-img mb-3">
      <h5 class="user-name">{{ user_name }}</h5>
      <p class="user-major text-muted">{{ user_major }}</p>
    </div>

    <!-- 기본 정보 -->
    <div class="info-block mt-4">
      <h6 class="block-title">기본 정보</h6>
      <ul class="info-list">
        <li><strong>학번:</strong> {{ user_student_id }}</li>
        <li><strong>학년:</strong> {{ user_year }}</li>
        <li><strong>전공:</strong> {{ user_major }}</li>
      </ul>
    </div>

    <!-- 알림 -->
    <div class="info-block mt-4">
      <h6 class="block-title">알림</h6>
      <div class="alert-list">
        {% if alerts %}
          {% for msg in alerts %}
            <p class="alert-item">• {{ msg }}</p>
          {% endfor %}
        {% else %}
          <p class="alert-empty">알림이 없습니다.</p>
        {% endif %}
      </div>
    </div>

    <!-- GPA 차트 -->
    <div class="info-block mt-4">
      <h6 class="block-title">학기별 평점 추이</h6>
      <div class="chart-area">
        <canvas id="topGpaChart" width="260" height="160"></canvas>
      </div>
    </div>
  </div>

  <!-- 🔸 오른쪽 패널 -->
  <div class="right-panel">
    <div class="section-box">
      <h4>이수 과목 현황</h4>
      <div class="row">
        <div class="col-md-4">
          <div class="card">
            <div class="p-3">
              <div class="summary-box mb-3">
                <p class="mb-1"><strong>총 이수 학점:</strong> <span id="mypage-total-credits">0</span></p>
                <p class="mb-0"><strong>전체 평점 평균:</strong> <span id="mypage-total-gpa">0.00</span></p>
              </div>
              <h6 class="text-muted">학기 목록</h6>
              <ul id="mypage-semester-list" class="list-group" style="max-height: 250px; overflow-y: auto;"></ul>
            </div>
          </div>
        </div>

        <div class="col-md-8">
          <div class="card">
            <div class="p-3">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="summary-box">
                  <h5 id="mypage-semester-title">학기를 선택하세요</h5>
                  <p class="mb-0 text-muted">이수 학점: <span id="mypage-semester-credits">0</span> | 평점 평균: <span id="mypage-semester-gpa">0.00</span></p>
                </div>
              </div>
              <div id="mypage-course-list" style="max-height: 300px; overflow-y: auto;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="section-box mt-4">
      <h4>졸업 요건 이수 현황</h4>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>구분</th>
            <th>이수 학점</th>
            <th>졸업 기준</th>
            <th>미이수</th>
            <th>충족</th>
          </tr>
        </thead>
        <tbody id="requirements-table-body">
          <!-- JS로 렌더링 -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script id="course-history-data" type="application/json">{{ course_history_json|safe }}</script>
<script id="requirements-tree-data" type="application/json">{{ requirements_tree_json|safe }}</script>
<script src="{% static 'home/js/mypage.js' %}"></script>

</body>
</html>
