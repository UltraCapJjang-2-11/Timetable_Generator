<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>시간표 생성</title>

    {% load static %}

    <link rel="stylesheet" type="text/css" href="{% static 'home/css/base_style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'home/css/timetable_style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'home/css/right_panel.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'home/css/chatbot.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'home/css/nl_timetable.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'home/css/left_panel.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'home/css/animations.css' %}">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>
    <header>
        <nav class="navigation">
            <a href="{% url 'dashboard' %}" class="logo">
                <img src="https://github.com/KSM017/ImageSource/blob/main/002.png?raw=true" alt="로고">
            </a>
            <div class="nav-links">
                <a href="{% url 'dashboard' %}">Home<span></span></a>
                <a href="{% url 'manage' %}">Manage<span></span></a>
                <a href="{% url 'mypage' %}">MyPage<span></span></a>
                <a href="{% url 'timetable' %}">TimeTable<span></span></a>
                <a href="#">Logout<span></span></a>
            </div>
        </nav>
    </header>

    <div class="container-fluid">
        {% include "home/timetable/left_panel.html" %}
        <div class="middle-panel">
            <table class="timetable">
                <thead>
                    <tr>
                        <th>시간</th>
                        <th>월</th>
                        <th>화</th>
                        <th>수</th>
                        <th>목</th>
                        <th>금</th>
                    </tr>
                </thead>
                <tbody>
                    <script>
                        // 이 스크립트는 페이지의 기본 구조를 동적으로 생성합니다.
                        // 복잡한 로직이 아니므로 HTML에 남겨두거나,
                        // 혹은 더 엄격한 분리를 위해 JS 파일의 초기화 함수로 옮길 수 있습니다.
                        const timetableBody = document.querySelector(".timetable tbody");
                        for (let hour = 9; hour <= 18; hour++) {
                            const row = document.createElement("tr");
                            const timeCell = document.createElement("td");
                            timeCell.textContent = `${hour}:00`;
                            row.appendChild(timeCell);
                            for (let i = 0; i < 5; i++) {
                                const cell = document.createElement("td");
                                cell.classList.add("timetable-cell");
                                cell.setAttribute("data-hour", hour);
                                cell.setAttribute("data-day", i);
                                row.appendChild(cell);
                            }
                            timetableBody.appendChild(row);
                        }
                    </script>
                </tbody>
            </table>
        </div>
        {% include "home/timetable/right_panel.html" %}
    </div>

    <div id="progress-overlay">
      <div id="progress-message">
        <p id="progress-text">시간표 생성 중...</p>
        <div id="progress-bar">
          <div id="progress-fill"></div>
        </div>
        <p id="progress-count"></p>
      </div>
    </div>

    <!-- 설문조사 오버레이 -->
    <div id="survey-overlay">
        <div class="survey-container">

            <!-- 닫기 버튼 -->
            <button class="survey-close-btn" onclick="hideSurvey()">×</button>

            <!-- 프로그레스 바 -->
            <div class="survey-progress-wrapper">
                <div class="survey-progress-bar">
                    <div class="survey-progress-fill" id="survey-progress-fill"></div>
                </div>
                <div class="survey-step-indicator">
                    <span id="current-step-text">1</span> / 9
                </div>
            </div>

            <!-- 단계 표시 인디케이터 -->
            <div class="survey-dots">
                <span class="dot active" data-step="1"></span>
                <span class="dot" data-step="2"></span>
                <span class="dot" data-step="3"></span>
                <span class="dot" data-step="4"></span>
                <span class="dot" data-step="5"></span>
                <span class="dot" data-step="6"></span>
                <span class="dot" data-step="7"></span>
                <span class="dot" data-step="8"></span>
                <span class="dot" data-step="9"></span>
            </div>

            <!-- STEP 1 -->
            <div class="survey-step active" data-step="1">
                <div class="step-header">
                    <div class="step-number">Step 1</div>
                    <h3>수강할 전공 학점과 교양 학점을 입력해주세요</h3>
                    <p class="step-description">이번 학기에 수강할 학점 수를 입력하세요</p>
                </div>
                <div class="credit-inputs">
                    <div class="input-group">
                        <label for="major-credit-input">전공 학점</label>
                        <input type="number" id="major-credit-input" placeholder="예: 12" min="0" max="24">
                        <small>0-24 학점</small>
                    </div>
                    <div class="input-group">
                        <label for="elective-credit-input">교양 학점</label>
                        <input type="number" id="elective-credit-input" placeholder="예: 6" min="0" max="24">
                        <small>0-24 학점</small>
                    </div>
                </div>
            </div>

            <!-- STEP 2 -->
            <div class="survey-step" data-step="2">
                <div class="step-header">
                    <div class="step-number">Step 2</div>
                    <h3>희망하는 공강 요일을 선택해주세요</h3>
                    <p class="step-description">수업이 없었으면 하는 요일을 선택하세요 (복수 선택 가능)</p>
                </div>
                <div class="weekday-options">
                    <input type="checkbox" id="survey-mon" value="월"><label for="survey-mon">월요일</label>
                    <input type="checkbox" id="survey-tue" value="화"><label for="survey-tue">화요일</label>
                    <input type="checkbox" id="survey-wed" value="수"><label for="survey-wed">수요일</label>
                    <input type="checkbox" id="survey-thu" value="목"><label for="survey-thu">목요일</label>
                    <input type="checkbox" id="survey-fri" value="금"><label for="survey-fri">금요일</label>
                    <input type="checkbox" id="none" value="없음"><label for="none">공강 필요 없음</label>
                </div>
            </div>

            <!-- STEP 3 -->
            <div class="survey-step" data-step="3">
                <div class="step-header">
                    <div class="step-number">Step 3</div>
                    <h3>제외하고 싶은 시간을 선택해주세요</h3>
                    <p class="step-description">수업을 듣고 싶지 않은 시간대를 클릭하세요 (선택사항)</p>
                </div>
                <table class="survey-timetable">
                    <thead>
                        <tr><th></th><th>월</th><th>화</th><th>수</th><th>목</th><th>금</th></tr>
                    </thead>
                    <tbody id="survey-tbody"></tbody>
                </table>
            </div>

            <!-- STEP 4 -->
            <div class="survey-step" data-step="4">
                <div class="step-header">
                    <div class="step-number">Step 4</div>
                    <h3>선호하는 교양 과목의 특징을 선택해주세요</h3>
                    <p class="step-description">원하는 교양 과목의 특징을 모두 선택하세요 (복수 선택 가능)</p>
                </div>
                <div class="tag-options">
                    <span data-tag="no-group">조별과제가 없는</span>
                    <span data-tag="no-presentation">발표가 없는</span>
                    <span data-tag="no-homework">과제가 없는</span>
                    <span data-tag="high-rating">별점이 높은</span>
                    <span data-tag="easy-grade">너그러운 성적</span>
                    <span data-tag="sports">운동</span>
                    <span data-tag="language">언어</span>
                    <span data-tag="science">과학</span>
                    <span data-tag="toeic">토익</span>
                    <span data-tag="culture">문화생활</span>
                </div>
            </div>

            <!-- STEP 5: 선호 교수 -->
            <div class="survey-step" data-step="5">
                <div class="step-header">
                    <div class="step-number">Step 5</div>
                    <h3>선호하는 교수님을 입력해주세요</h3>
                    <p class="step-description">수업을 듣고 싶은 교수님이 있다면 입력하세요 (선택사항)</p>
                </div>
                <div class="preference-input-container">
                    <div class="autocomplete-wrapper">
                        <input type="text" id="preferred-instructor-input" placeholder="교수님 이름을 입력하고 Enter를 누르세요" autocomplete="off">
                        <div id="preferred-instructor-autocomplete" class="autocomplete-dropdown"></div>
                    </div>
                    <div id="preferred-instructors-list" class="preference-list"></div>
                    <small class="input-hint">여러 명 입력 가능합니다. Enter키로 추가하세요.</small>
                </div>
            </div>

            <!-- STEP 6: 기피 교수 -->
            <div class="survey-step" data-step="6">
                <div class="step-header">
                    <div class="step-number">Step 6</div>
                    <h3>기피하고 싶은 교수님을 입력해주세요</h3>
                    <p class="step-description">수업을 듣고 싶지 않은 교수님이 있다면 입력하세요 (선택사항)</p>
                </div>
                <div class="preference-input-container">
                    <div class="autocomplete-wrapper">
                        <input type="text" id="avoid-instructor-input" placeholder="교수님 이름을 입력하고 Enter를 누르세요" autocomplete="off">
                        <div id="avoid-instructor-autocomplete" class="autocomplete-dropdown"></div>
                    </div>
                    <div id="avoid-instructors-list" class="preference-list"></div>
                    <small class="input-hint">여러 명 입력 가능합니다. Enter키로 추가하세요.</small>
                </div>
            </div>

            <!-- STEP 7: 선호 과목 -->
            <div class="survey-step" data-step="7">
                <div class="step-header">
                    <div class="step-number">Step 7</div>
                    <h3>꼭 듣고 싶은 과목을 입력해주세요</h3>
                    <p class="step-description">시간표에 꼭 포함하고 싶은 과목이 있다면 입력하세요 (선택사항)</p>
                </div>
                <div class="preference-input-container">
                    <div class="autocomplete-wrapper">
                        <input type="text" id="preferred-course-input" placeholder="과목명을 입력하고 Enter를 누르세요" autocomplete="off">
                        <div id="preferred-course-autocomplete" class="autocomplete-dropdown"></div>
                    </div>
                    <div id="preferred-courses-list" class="preference-list"></div>
                    <small class="input-hint">여러 과목 입력 가능합니다. Enter키로 추가하세요.</small>
                </div>
            </div>

            <!-- STEP 8: 기피 과목 -->
            <div class="survey-step" data-step="8">
                <div class="step-header">
                    <div class="step-number">Step 8</div>
                    <h3>듣고 싶지 않은 과목을 입력해주세요</h3>
                    <p class="step-description">시간표에서 제외하고 싶은 과목이 있다면 입력하세요 (선택사항)</p>
                </div>
                <div class="preference-input-container">
                    <div class="autocomplete-wrapper">
                        <input type="text" id="avoid-course-input" placeholder="과목명을 입력하고 Enter를 누르세요" autocomplete="off">
                        <div id="avoid-course-autocomplete" class="autocomplete-dropdown"></div>
                    </div>
                    <div id="avoid-courses-list" class="preference-list"></div>
                    <small class="input-hint">여러 과목 입력 가능합니다. Enter키로 추가하세요.</small>
                </div>
            </div>

            <!-- STEP 9: 이동거리 및 시간표 선호도 -->
            <div class="survey-step" data-step="9">
                <div class="step-header">
                    <div class="step-number">Step 9</div>
                    <h3>시간표 스타일을 선택해주세요</h3>
                    <p class="step-description">마지막 단계입니다! 원하는 시간표 스타일을 설정하세요</p>
                </div>
                <div class="style-preferences">
                    <div class="preference-group">
                        <label>최대 이동 시간 (연속 수업 간)</label>
                        <select id="max-walking-time">
                            <option value="5">5분 이내 - 건물 간 이동 최소화</option>
                            <option value="10" selected>10분 이내 - 적당한 이동 시간</option>
                            <option value="15">15분 이내 - 여유있는 이동</option>
                            <option value="20">상관없음 - 이동 시간 고려 안 함</option>
                        </select>
                    </div>
                    <div class="preference-group">
                        <label>시간표 밀집도</label>
                        <div class="radio-options-card">
                            <div class="radio-card">
                                <input type="radio" id="compact-yes" name="compact" value="yes">
                                <label for="compact-yes">
                                    <div class="radio-card-title">공강 최소화</div>
                                    <div class="radio-card-desc">빽빽한 시간표로 빨리 끝내기</div>
                                </label>
                            </div>
                            <div class="radio-card">
                                <input type="radio" id="compact-no" name="compact" value="no" checked>
                                <label for="compact-no">
                                    <div class="radio-card-title">적당한 공강</div>
                                    <div class="radio-card-desc">여유있는 시간표</div>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="preference-group">
                        <label>선호 시간대</label>
                        <div class="checkbox-options-card">
                            <div class="checkbox-card">
                                <input type="checkbox" id="prefer-morning" value="morning">
                                <label for="prefer-morning">
                                    <div class="checkbox-card-title">오전 수업 선호</div>
                                    <div class="checkbox-card-desc">9시 - 12시</div>
                                </label>
                            </div>
                            <div class="checkbox-card">
                                <input type="checkbox" id="prefer-afternoon" value="afternoon">
                                <label for="prefer-afternoon">
                                    <div class="checkbox-card-title">오후 수업 선호</div>
                                    <div class="checkbox-card-desc">12시 - 18시</div>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="preference-group">
                        <label>모델 선택</label>
                        <div class="radio-options-card" style="grid-template-columns: 1fr 1fr;">
                            <div class="radio-card">
                                <input type="radio" id="opt-lite" name="optimization" value="BASIC">
                                <label for="opt-lite">
                                    <div class="radio-card-title">Lite</div>
                                    <div class="radio-card-desc">빠른 생성<br>간단한 시간표</div>
                                </label>
                            </div>
                            <div class="radio-card">
                                <input type="radio" id="opt-standard" name="optimization" value="ADVANCED" checked>
                                <label for="opt-standard">
                                    <div class="radio-card-title">Standard</div>
                                    <div class="radio-card-desc">추천<br>균형잡힌 품질</div>
                                </label>
                            </div>
                            <div class="radio-card">
                                <input type="radio" id="opt-pro" name="optimization" value="EXPERT">
                                <label for="opt-pro">
                                    <div class="radio-card-title">Pro</div>
                                    <div class="radio-card-desc">고품질<br>까다로운 조건에 적합</div>
                                </label>
                            </div>
                            <div class="radio-card">
                                <input type="radio" id="opt-ultra" name="optimization" value="ULTRA">
                                <label for="opt-ultra">
                                    <div class="radio-card-title">Ultra</div>
                                    <div class="radio-card-desc">최상급<br>완벽한 맞춤 시간표</div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer: 버튼 -->
            <div class="survey-footer">
                <button class="prev-btn" id="prev-btn">← 이전</button>
                <button class="next-btn" id="next-btn">다음 →</button>
            </div>

        </div>
    </div>

    {% include "home/timetable/chatbot.html" %}

    <script src="{% static 'home/js/timetable/chatbot.js' %}"></script>
    <script src="{% static 'home/js/timetable/survey.js' %}"></script>
    <script type="module" src="{% static 'home/js/timetable/main.js' %}"></script>
    <script src="{% static 'home/js/timetable/right_panel.js' %}"></script>
    <script type="module" src="{% static 'home/js/timetable/left_panel.js' %}"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>